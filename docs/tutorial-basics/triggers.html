<!doctype html>
<html lang="es" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-tutorial-basics/triggers">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Vistas SQL | Laravel 10: Crea aplicaciones web escalables y seguras</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://jesquiliche.github.io/curso-laravel/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://jesquiliche.github.io/curso-laravel/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://jesquiliche.github.io/curso-laravel/docs/tutorial-basics/triggers"><meta data-rh="true" name="docusaurus_locale" content="es"><meta data-rh="true" name="docsearch:language" content="es"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Vistas SQL | Laravel 10: Crea aplicaciones web escalables y seguras"><meta data-rh="true" name="description" content="Introducción"><meta data-rh="true" property="og:description" content="Introducción"><link data-rh="true" rel="icon" href="/curso-laravel/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://jesquiliche.github.io/curso-laravel/docs/tutorial-basics/triggers"><link data-rh="true" rel="alternate" href="https://jesquiliche.github.io/curso-laravel/docs/tutorial-basics/triggers" hreflang="es"><link data-rh="true" rel="alternate" href="https://jesquiliche.github.io/curso-laravel/docs/tutorial-basics/triggers" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/curso-laravel/blog/rss.xml" title="Laravel 10: Crea aplicaciones web escalables y seguras RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/curso-laravel/blog/atom.xml" title="Laravel 10: Crea aplicaciones web escalables y seguras Atom Feed"><link rel="stylesheet" href="/curso-laravel/assets/css/styles.66d1563d.css">
<link rel="preload" href="/curso-laravel/assets/js/runtime~main.46f48be8.js" as="script">
<link rel="preload" href="/curso-laravel/assets/js/main.ea557002.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Saltar al contenido principal"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Saltar al contenido principal</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/curso-laravel/"><div class="navbar__logo"><img src="/curso-laravel/img/laravel.png" alt="Laravel 10" class="themedImage_ToTc themedImage--light_HNdA"><img src="/curso-laravel/img/laravel.png" alt="Laravel 10" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Laravel 10</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/curso-laravel/docs/intro">Tutorial</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Volver al principio" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/curso-laravel/docs/intro">Introducción</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/curso-laravel/docs/category/guía-de-laravel">Guía de Laravel</a><button aria-label="Toggle the collapsible sidebar category &#x27;Guía de Laravel&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/curso-laravel/docs/tutorial-basics/configuracion">Instalación y configuración</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/curso-laravel/docs/tutorial-basics/migraciones">Migraciones</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/curso-laravel/docs/category/modelos">Modelos</a><button aria-label="Toggle the collapsible sidebar category &#x27;Modelos&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/curso-laravel/docs/tutorial-basics/seeders">Rellenando la BB.DD</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/curso-laravel/docs/tutorial-basics/consultas">Consultas Eloquent</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/curso-laravel/docs/category/eloquent-y-sql">Eloquent y SQL</a><button aria-label="Toggle the collapsible sidebar category &#x27;Eloquent y SQL&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/curso-laravel/docs/tutorial-basics/triggers">Vistas SQL</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/curso-laravel/docs/category/rutas-y-controladores">Rutas y controladores</a><button aria-label="Toggle the collapsible sidebar category &#x27;Rutas y controladores&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/curso-laravel/docs/category/vistas-blade">Vistas Blade</a><button aria-label="Toggle the collapsible sidebar category &#x27;Vistas Blade&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/curso-laravel/docs/category/calidad-del-software">Calidad del Software</a><button aria-label="Toggle the collapsible sidebar category &#x27;Calidad del Software&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/curso-laravel/docs/category/administración">Administración</a><button aria-label="Toggle the collapsible sidebar category &#x27;Administración&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/curso-laravel/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/curso-laravel/docs/category/guía-de-laravel"><span itemprop="name">Guía de Laravel</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Vistas SQL</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">En esta página</button></div><div class="theme-doc-markdown markdown"><h1>Vistas SQL</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introducción">Introducción<a href="#introducción" class="hash-link" aria-label="Enlace directo al Introducción" title="Enlace directo al Introducción">​</a></h2><ul><li>La gestión de bases de datos es una tarea fundamental en la mayoría de los proyectos de software. Ya sea que estés desarrollando una aplicación web, un servicio de back-end o un sistema de análisis de datos, es probable que necesites interactuar con una o varias bases de datos. La gestión de estas bases de datos puede incluir tareas como crear tablas, insertar y actualizar datos, realizar consultas complejas y automatizar tareas a través de procedimientos almacenados.</li><li>En este contexto, las vistas y triggers son herramientas muy útiles que nos permiten simplificar y optimizar nuestras consultas y operaciones. Una vista es una tabla virtual que se crea a partir de una consulta compleja y que se puede utilizar en consultas posteriores como si fuera una tabla real. Un trigger es un procedimiento almacenado que se ejecuta automáticamente cuando se produce una acción en una tabla, como insertar, actualizar o eliminar registros. Los triggers pueden ser muy útiles para automatizar tareas como la actualización de datos en otras tablas o el envío de notificaciones por correo electrónico.</li><li>En este tutorial, vamos a aprender cómo trabajar con vistas y triggers en Eloquent, el ORM de Laravel. Eloquent es una de las herramientas más populares para la gestión de bases de datos en Laravel y es conocido por su facilidad de uso y su potencia. A lo largo del tutorial, te mostraremos cómo crear vistas y triggers en Eloquent y cómo utilizarlos para automatizar tareas y mejorar el rendimiento de tus consultas. Esperamos que, al final del tutorial, tengas un conocimiento sólido sobre estas herramientas y puedas aplicarlas en tus propios proyectos.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="vista-v_productos">Vista v_productos<a href="#vista-v_productos" class="hash-link" aria-label="Enlace directo al Vista v_productos" title="Enlace directo al Vista v_productos">​</a></h3><p>A veces Eloquent presenta dificultades para relalizar ciertas operaciones SQL.</p><p>En este ejemplo utilizaremos una vista creada por una migración que podras encontrar
dentro de proyecto.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>DB:statement</div><div class="admonitionContent_S0QG"><p><code>DB::statement</code> es un método de la clase <code>Illuminate\Support\Facades\DB</code> que se utiliza para ejecutar consultas SQL directamente en la base de datos. Este método toma una cadena de consulta SQL como argumento y la ejecuta en la base de datos subyacente. </p><p>Este método es útil para ejecutar comandos de SQL que no tienen una representación directa en la API de Eloquent, como la creación o eliminación de vistas, la creación de índices de base de datos, la modificación de columnas, entre otros.</p><p>Es importante tener en cuenta que <code>DB::statement</code> no devuelve ningún resultado. Por lo tanto, no se puede utilizar para recuperar datos de la base de datos. En su lugar, se utiliza para ejecutar consultas que modifican la estructura de la base de datos o realizan operaciones que no requieren un conjunto de resultados.</p><p>Aquí hay un ejemplo de cómo se utiliza <code>DB::statement</code> para crear una vista en la base de datos:</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DB::statement(&#x27;CREATE VIEW v_clientes AS SELECT * FROM clientes WHERE activo = 1&#x27;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código al portapapeles" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>En este ejemplo, se utiliza <code>DB::statement</code> para ejecutar una consulta SQL que crea una vista llamada <code>v_clientes</code>. La vista se crea a partir de la tabla <code>clientes</code>, seleccionando solo las filas donde el campo <code>activo</code> es igual a 1.</p><p>En conclusión, <code>DB::statement</code> es una herramienta útil para ejecutar consultas SQL directamente en la base de datos, lo que permite realizar operaciones avanzadas que no están disponibles a través de la API de Eloquent.</p></div></div><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Database\Migrations\Migration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Database\Schema\Blueprint;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Support\Facades\DB;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Support\Facades\Schema;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return new class extends Migration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Run the migrations.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function up()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DB::statement(&quot;CREATE OR REPLACE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        VIEW `v_productos` AS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SELECT </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            `p`.`id` AS `id`,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            `p`.`nombre` AS `nombre`,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            `p`.`descripcion` AS `descripcion`,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            `p`.`iva_id` AS `iva_id`,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            `p`.`precio` AS `precio`,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            `s`.`nombre` AS `subcategoria`,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            `c`.`nombre` AS `categoria`,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            `m`.`nombre` AS `marca`,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            `p`.`imagen` AS `imagen`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FROM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            (((`productos` `p`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            LEFT JOIN `subcategorias` `s` ON ((`p`.`subcategoria_id` = `s`.`id`)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            JOIN `categorias` `c` ON ((`c`.`id` = `s`.`categoria_id`)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            JOIN `marcas` `m` ON ((`m`.`id` = `p`.`marca_id`))) ORDER BY CATEGORIA,SUBCATEGORIA;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Reverse the migrations.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function down()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DB::statement(&#x27;DROP VIEW v_productos;&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código al portapapeles" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Este código crea una vista llamada <code>v_productos</code> que muestra una lista de productos con su respectiva subcategoría, categoría y marca. Para ello, se utiliza una consulta SQL con múltiples join y se ordena por categoría y subcategoría.</p><p>La primera línea de la consulta, <code>CREATE OR REPLACE VIEW &#x27;v_productos&#x27; AS</code>, indica que se está creando una vista llamada <code>v_productos</code>.</p><p>Dentro del <code>SELECT</code> statement, se seleccionan los campos que se desean mostrar en la vista. Se usan alias para que los nombres sean más descriptivos.</p><p>Luego, se utiliza el operador <code>LEFT JOIN</code> para hacer una unión izquierda entre la tabla <code>productos</code> y <code>subcategorias</code>, con el fin de obtener la subcategoría correspondiente de cada producto. Como algunos productos pueden no tener una subcategoría asignada, se utiliza <code>LEFT JOIN</code> en lugar de <code>JOIN</code> para incluir todos los productos, incluso aquellos que no tienen una subcategoría correspondiente.</p><p>Posteriormente, se utiliza <code>JOIN</code> para unir la tabla <code>categorias</code> a la tabla <code>subcategorias</code>, de manera que se pueda obtener la categoría correspondiente de cada producto.</p><p>Por último, se utiliza otro <code>JOIN</code> para unir la tabla <code>marcas</code> a la tabla <code>productos</code>, con el fin de obtener la marca correspondiente de cada producto.</p><p>La vista resultante tiene un conjunto de campos que muestran la información relevante de cada producto, ç
junto con su subcategoría, categoría y marca correspondientes.
La vista se ordena por categoría y subcategoría para facilitar
la visualización de los productos.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="como-sería-la-consulta-en-elocuent">Como sería la consulta en Elocuent<a href="#como-sería-la-consulta-en-elocuent" class="hash-link" aria-label="Enlace directo al Como sería la consulta en Elocuent" title="Enlace directo al Como sería la consulta en Elocuent">​</a></h3><p>Para ejecutar consultas SQL en Laravel utilizando Eloquent, se puede utilizar el método <code>select</code> de la clase <code>DB</code> de Laravel. Por ejemplo, para obtener los campos <code>id</code>, <code>nombre</code>, <code>descripcion</code>, <code>precio</code>, <code>subcategoria</code>, <code>categoria</code>, <code>marca</code> e <code>imagen</code> de la tabla <code>productos</code> y de sus tablas relacionadas <code>subcategorias</code>, <code>categorias</code> y <code>marcas</code>, se puede utilizar el siguiente código en Eloquent:</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Support\Facades\DB;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$productos = DB::table(&#x27;productos&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;leftJoin(&#x27;subcategorias&#x27;, &#x27;productos.subcategoria_id&#x27;, &#x27;=&#x27;, &#x27;subcategorias.id&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;join(&#x27;categorias&#x27;, &#x27;subcategorias.categoria_id&#x27;, &#x27;=&#x27;, &#x27;categorias.id&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;join(&#x27;marcas&#x27;, &#x27;productos.marca_id&#x27;, &#x27;=&#x27;, &#x27;marcas.id&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;select(&#x27;productos.id&#x27;, &#x27;productos.nombre&#x27;, &#x27;productos.descripcion&#x27;, &#x27;productos.precio&#x27;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             &#x27;subcategorias.nombre as subcategoria&#x27;, &#x27;categorias.nombre as categoria&#x27;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             &#x27;marcas.nombre as marca&#x27;, &#x27;productos.imagen&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;orderBy(&#x27;categorias.nombre&#x27;, &#x27;asc&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;orderBy(&#x27;subcategorias.nombre&#x27;, &#x27;asc&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;get();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código al portapapeles" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Este código utiliza el método <code>join</code> para unir las tablas <code>productos</code>, <code>subcategorias</code>, <code>categorias</code> y <code>marcas</code> según las claves foráneas. Luego, utiliza el método <code>select</code> para seleccionar los campos necesarios y renombrar algunos campos de las tablas relacionadas utilizando la cláusula <code>as</code>. Finalmente, utiliza el método <code>orderBy</code> para ordenar los resultados por <code>categorias.nombre</code> y <code>subcategorias.nombre</code>, y el método <code>get</code> para obtener los resultados.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="diferencias-entre-un-método-y-otro">Diferencias entre un método y otro<a href="#diferencias-entre-un-método-y-otro" class="hash-link" aria-label="Enlace directo al Diferencias entre un método y otro" title="Enlace directo al Diferencias entre un método y otro">​</a></h3><p>La principal diferencia entre hacerlo con Eloquent y con una vista de base de datos es que en Eloquent, no se crea una vista en la base de datos. En su lugar, se define una función en un modelo que devuelve los datos de la vista. Esto tiene algunas implicaciones:</p><ul><li>No se crea una vista en la base de datos, lo que significa que no se puede acceder directamente a la vista desde otra aplicación que no use Eloquent.</li><li>Al no ser una vista en la base de datos, no se pueden utilizar las funciones específicas de cada motor de base de datos para optimizar el rendimiento de la vista. En cambio, todo el trabajo de filtrado y selección de datos se realiza en la aplicación utilizando Eloquent.</li><li>Sin embargo, Eloquent ofrece una gran cantidad de características que permiten personalizar la consulta de los datos, lo que puede resultar más flexible que trabajar con una vista de base de datos predefinida.</li></ul><p>En conclusión, la elección entre utilizar una vista
de base de datos o definir una función en Eloquent para
obtener los datos depende del caso de uso específico y de
las necesidades de la aplicación. Si se necesita una vista
específica para ser utilizada por varias aplicaciones o
herramientas, entonces una vista de base de datos podría
ser la mejor opción. Si se necesita más flexibilidad para
personalizar la consulta de datos, o si se quiere evitar el
mantenimiento adicional de la vista en la base de datos,
entonces definir una función en Eloquent podría ser la mejor opción.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="v_ofertas">v_ofertas<a href="#v_ofertas" class="hash-link" aria-label="Enlace directo al v_ofertas" title="Enlace directo al v_ofertas">​</a></h3><p>Este código es una migración de Laravel que crea una vista de base de datos llamada <code>v_ofertas</code>. La vista utiliza la cláusula <code>SELECT</code> para seleccionar los campos que se mostrarán en la vista, incluyendo campos de las tablas <code>v_productos</code> y <code>ofertas</code>. La cláusula <code>JOIN</code> se utiliza para unir las dos tablas, de forma que sólo se muestren los productos que tienen una oferta asociada.</p><p>El código utiliza la sintaxis de Laravel para definir la vista. En el método <code>up()</code>, se utiliza la función <code>DB::statement()</code> para ejecutar la consulta SQL que crea la vista. En el método <code>down()</code>, se utiliza la función <code>DB::statement()</code> de nuevo, pero esta vez para eliminar la vista.</p><p>Aquí te dejo el código completo:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Database\Migrations\Migration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Database\Schema\Blueprint;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Support\Facades\DB;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Support\Facades\Schema;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return new class extends Migration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Run the migrations.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function up()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DB::statement(&quot;CREATE OR REPLACE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        VIEW `v_ofertas` AS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SELECT </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            `v`.`id` AS `id`,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            `v`.`nombre` AS `nombre`,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            `v`.`descripcion` AS `descripcion`,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            `v`.`iva_id` AS `iva_id`,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            `v`.`subcategoria` AS `subcategoria`,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            `v`.`categoria` AS `categoria`,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            `v`.`marca` AS `marca`,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            `v`.`imAGEN` AS `imAGEN`,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            `o`.`descripcion` AS `descripcio_oferta`,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            `o`.`id` AS `id_oferta`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FROM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            (`v_productos` `v`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            JOIN `ofertas` `o` ON ((`v`.`id` = `o`.`producto_id`)));&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Reverse the migrations.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function down()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DB::statement(&quot;DROP VIEW v_ofertas&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código al portapapeles" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="v_proveedores">v_proveedores<a href="#v_proveedores" class="hash-link" aria-label="Enlace directo al v_proveedores" title="Enlace directo al v_proveedores">​</a></h3><p>¡Por supuesto! En este caso, se trata de una migración de Laravel que crea una vista de base de datos llamada <code>v_proveedores</code>. La vista utiliza la cláusula <code>SELECT</code> para seleccionar los campos que se mostrarán en la vista, incluyendo campos de la tabla <code>proveedores</code> y de las tablas <code>poblaciones</code> y <code>provincias</code>. La cláusula <code>JOIN</code> se utiliza para unir las tres tablas y obtener los datos necesarios para la vista.</p><p>El código utiliza la sintaxis de Laravel para definir la vista. En el método <code>up()</code>, se utiliza la función <code>DB::statement()</code> para ejecutar la consulta SQL que crea la vista. La consulta utiliza la cláusula <code>INNER JOIN</code> para unir las tablas <code>proveedores</code>, <code>poblaciones</code> y <code>provincias</code>, y la cláusula <code>SELECT</code> para seleccionar los campos que se mostrarán en la vista. En el método <code>down()</code>, se utiliza la función <code>Schema::dropIfExists()</code> para eliminar la vista.</p><p>Es importante tener en cuenta que la consulta SQL utilizada en esta migración hace referencia a tablas específicas de una base de datos. Si se desea utilizar este código en otro entorno, puede ser necesario cambiar los nombres de las tablas y campos para que coincidan con la estructura de la base de datos. Aquí está el código completo:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Database\Migrations\Migration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Database\Schema\Blueprint;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Support\Facades\DB;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Support\Facades\Schema;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return new class extends Migration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Run the migrations.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function up()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DB::statement(&quot;CREATE OR REPLACE VIEW v_proveedores AS SELECT pr.*,pob.nombre as poblacion,pro.nombre as provincia </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FROM comercio.proveedores pr INNER JOIN poblaciones pob ON pr.cod_postal=pob.codigo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        INNER JOIN provincias pro ON pro.codigo=pob.provincia_cod;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Reverse the migrations.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function down()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Schema::dropIfExists(&#x27;v_proveedores&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código al portapapeles" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/tutorial-basics/triggers.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Editar esta página</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Navegación de páginas de documentos"><a class="pagination-nav__link pagination-nav__link--prev" href="/curso-laravel/docs/tutorial-basics/sql/conclusiones"><div class="pagination-nav__sublabel">Anterior</div><div class="pagination-nav__label">Conclusiones</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/curso-laravel/docs/category/rutas-y-controladores"><div class="pagination-nav__sublabel">Siguiente</div><div class="pagination-nav__label">Rutas y controladores</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introducción" class="table-of-contents__link toc-highlight">Introducción</a><ul><li><a href="#vista-v_productos" class="table-of-contents__link toc-highlight">Vista v_productos</a></li><li><a href="#como-sería-la-consulta-en-elocuent" class="table-of-contents__link toc-highlight">Como sería la consulta en Elocuent</a></li><li><a href="#diferencias-entre-un-método-y-otro" class="table-of-contents__link toc-highlight">Diferencias entre un método y otro</a></li><li><a href="#v_ofertas" class="table-of-contents__link toc-highlight">v_ofertas</a></li><li><a href="#v_proveedores" class="table-of-contents__link toc-highlight">v_proveedores</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Jesús Quintana Esquiliche</div></div></div></footer></div>
<script src="/curso-laravel/assets/js/runtime~main.46f48be8.js"></script>
<script src="/curso-laravel/assets/js/main.ea557002.js"></script>
</body>
</html>