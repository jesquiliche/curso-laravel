"use strict";(self.webpackChunkeloquent=self.webpackChunkeloquent||[]).push([[2134],{3905:(e,a,n)=>{n.d(a,{Zo:()=>d,kt:()=>b});var t=n(7294);function o(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function i(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,t)}return n}function l(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?i(Object(n),!0).forEach((function(a){o(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function s(e,a){if(null==e)return{};var n,t,o=function(e,a){if(null==e)return{};var n,t,o={},i=Object.keys(e);for(t=0;t<i.length;t++)n=i[t],a.indexOf(n)>=0||(o[n]=e[n]);return o}(e,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)n=i[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var r=t.createContext({}),c=function(e){var a=t.useContext(r),n=a;return e&&(n="function"==typeof e?e(a):l(l({},a),e)),n},d=function(e){var a=c(e.components);return t.createElement(r.Provider,{value:a},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var a=e.children;return t.createElement(t.Fragment,{},a)}},m=t.forwardRef((function(e,a){var n=e.components,o=e.mdxType,i=e.originalType,r=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=c(n),m=o,b=u["".concat(r,".").concat(m)]||u[m]||p[m]||i;return n?t.createElement(b,l(l({ref:a},d),{},{components:n})):t.createElement(b,l({ref:a},d))}));function b(e,a){var n=arguments,o=a&&a.mdxType;if("string"==typeof e||o){var i=n.length,l=new Array(i);l[0]=m;var s={};for(var r in a)hasOwnProperty.call(a,r)&&(s[r]=a[r]);s.originalType=e,s[u]="string"==typeof e?e:o,l[1]=s;for(var c=2;c<i;c++)l[c]=n[c];return t.createElement.apply(null,l)}return t.createElement.apply(null,n)}m.displayName="MDXCreateElement"},8334:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>r,contentTitle:()=>l,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var t=n(7462),o=(n(7294),n(3905));const i={sidebar_position:3},l="M\xe1s sobre vistas",s={unversionedId:"tutorial-basics/Vistas/vista",id:"tutorial-basics/Vistas/vista",title:"M\xe1s sobre vistas",description:"Formulario de b\xfasqueda",source:"@site/docs/tutorial-basics/Vistas/03-vista.md",sourceDirName:"tutorial-basics/Vistas",slug:"/tutorial-basics/Vistas/vista",permalink:"/curso-laravel/docs/tutorial-basics/Vistas/vista",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/tutorial-basics/Vistas/03-vista.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Directivas Blade",permalink:"/curso-laravel/docs/tutorial-basics/Vistas/directivas"},next:{title:"Vistas y rutas protegidas",permalink:"/curso-laravel/docs/tutorial-basics/Vistas/rutasprotegidas"}},r={},c=[{value:"Formulario de b\xfasqueda",id:"formulario-de-b\xfasqueda",level:2},{value:"C\xf3digo del controlador",id:"c\xf3digo-del-controlador",level:3},{value:"Anuncios.index",id:"anunciosindex",level:2},{value:"An\xe1lisis del formulario de filtro",id:"an\xe1lisis-del-formulario-de-filtro",level:3},{value:"Vista indexFilter",id:"vista-indexfilter",level:2},{value:"Tablas relacionadas en la consulta",id:"tablas-relacionadas-en-la-consulta",level:3},{value:"Vista anuncios.show",id:"vista-anunciosshow",level:2}],d={toc:c},u="wrapper";function p(e){let{components:a,...i}=e;return(0,o.kt)(u,(0,t.Z)({},d,i,{components:a,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"m\xe1s-sobre-vistas"},"M\xe1s sobre vistas"),(0,o.kt)("h2",{id:"formulario-de-b\xfasqueda"},"Formulario de b\xfasqueda"),(0,o.kt)("p",null,"Vamos a entrar de lleno en la definici\xf3n de este formulario, el cual se encuentra en la vista Home."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Busqueda",src:n(6326).Z,width:"1132",height:"236"})),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html",metastring:"title='Formulario de b\xfasqueda'",title:"'Formulario",de:!0,"b\xfasqueda'":!0},'<form action="{{ route(\'home.filter\') }}" method="POST">\n    @csrf\n    <div class="row">\n        <div class="col-lg-4">\n            <input type="text" name="titulo" class="form-control" placeholder="Que estas buscando...">\n        </div>\n        <div class="col-lg-3">\n            <select name="subcategoria_id" class="form-control">\n                \x3c!-- Iteraci\xf3n sobre las categor\xedas --\x3e\n                @foreach ($categorias as $categoria)\n                    <optgroup label="{{ $categoria->nombre }}">\n                        \x3c!-- Iteraci\xf3n sobre las subcategor\xedas --\x3e\n                        @foreach ($categoria->subcategorias as $subcategoria)\n                            <option value="{{ $subcategoria->id }}">{{subcategoria->nombre }}\n                            </option>\n                        @endforeach\n                        </optgroup>\n                    @endforeach\n            </select>\n        </div>\n        <div class="col-lg-3">\n            <input type="text" name="poblacion" class="form-control" placeholder="Localidad">\n        </div>\n        <div class="col-lg-2">\n            <input type="submit" value="Buscar" class="form-control btn btn-danger">\n        </div>\n    </div>\n</form>\n')),(0,o.kt)("p",null,"El formulario que hemos creado en esta vista de Laravel tiene como prop\xf3sito principal permitir a los usuarios realizar b\xfasquedas espec\xedficas en nuestra aplicaci\xf3n. A continuaci\xf3n, desgloso cada elemento del formulario y su funci\xf3n:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Action y Method"),": El atributo ",(0,o.kt)("inlineCode",{parentName:"li"},"action")," especifica la URL a la que se enviar\xe1n los datos del formulario cuando se env\xede, en este caso, utilizamos la ruta ",(0,o.kt)("inlineCode",{parentName:"li"},"home.filter")," para procesar la b\xfasqueda. El atributo ",(0,o.kt)("inlineCode",{parentName:"li"},"method")," indica que la solicitud se realizar\xe1 mediante el m\xe9todo POST, lo que significa que los datos del formulario se enviar\xe1n de forma segura y no se mostrar\xe1n en la URL. La ruta ",(0,o.kt)("strong",{parentName:"li"},"home.filter")," deber\xe1 hallarse en nuestro fichero de rutas ",(0,o.kt)("strong",{parentName:"li"},"web.php")," de la siguiente forma:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"Route::post('/anunciosFilter', [HomeController::class,'anunciosFilter'])->name('home.filter');\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"CSRF Token"),": Para proteger el formulario contra ataques de falsificaci\xf3n de solicitudes entre sitios (CSRF), se incluye la directiva ",(0,o.kt)("inlineCode",{parentName:"p"},"@csrf"),". Esta directiva genera un token \xfanico para cada solicitud y ayuda a verificar que la solicitud provenga de nuestro propio sitio web y no de una fuente malintencionada.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Campos del formulario"),": El formulario consta de varios campos que permiten a los usuarios refinar su b\xfasqueda:"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},'Un campo de texto llamado "titulo" donde los usuarios pueden ingresar palabras clave relacionadas con lo que est\xe1n buscando en la aplicaci\xf3n.'),(0,o.kt)("li",{parentName:"ul"},'Un men\xfa desplegable llamado "subcategoria_id" que muestra las diferentes subcategor\xedas disponibles en nuestro blog. Utilizando la directiva ',(0,o.kt)("inlineCode",{parentName:"li"},"@foreach"),", iteramos sobre la variable ",(0,o.kt)("inlineCode",{parentName:"li"},"$categorias")," para mostrar las opciones de subcategor\xedas disponibles dentro de cada categor\xeda."),(0,o.kt)("li",{parentName:"ul"},'Un campo de texto llamado "poblacion" que permite a los usuarios ingresar la localidad o lugar relacionado con su b\xfasqueda en la aplicaci\xf3n.'))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Bot\xf3n de env\xedo"),': El formulario incluye un bot\xf3n "Buscar" con la clase de estilo ',(0,o.kt)("inlineCode",{parentName:"p"},"btn btn-danger")," que permite a los usuarios enviar el formulario y realizar la b\xfasqueda."))),(0,o.kt)("h3",{id:"c\xf3digo-del-controlador"},"C\xf3digo del controlador"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"}," public function anunciosFilter(Request $request){\n\n    $poblacion=$request->input('poblacion');\n    $titulo=$request->input('titulo');\n    $subcategoriaId=$request->input('subcategoria_id');\n    \n    $anuncios=DB::table('anuncios as A')\n    ->select('S.nombre', 'P.nombre', 'A.*')\n    ->join('subcategorias as S', 'A.subcategoria_id', '=', 'S.id')\n    ->join('poblaciones as P', 'P.codigo', '=', 'A.cod_postal')\n    ->where('P.nombre', 'like', $poblacion .'%')\n    ->where('A.titulo', 'like', '%'.$titulo.'%')\n    ->where('S.id', '=', $subcategoriaId)\n    ->get();\n\n    $estados=Estado::all();\n\n    $categorias=Categoria::all();\n    return view('anuncios.index', compact('anuncios','categorias','estados','poblacion','titulo','subcategoriaId'));\n\n    }\n")),(0,o.kt)("p",null,"En el controlador ",(0,o.kt)("strong",{parentName:"p"},"HomeController"),", se define una funci\xf3n llamada ",(0,o.kt)("inlineCode",{parentName:"p"},"anunciosFilter")," que maneja una solicitud HTTP. Esta funci\xf3n se ejecuta cuando un formulario es enviado desde la vista ",(0,o.kt)("strong",{parentName:"p"},"Home"),". "),(0,o.kt)("p",null,"En primer lugar, se obtienen los valores de los campos ",(0,o.kt)("inlineCode",{parentName:"p"},"poblacion"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"titulo")," y ",(0,o.kt)("inlineCode",{parentName:"p"},"subcategoria_id")," del formulario, utilizando el objeto ",(0,o.kt)("inlineCode",{parentName:"p"},"$request"),". Estos valores representan los criterios de b\xfasqueda proporcionados por el usuario."),(0,o.kt)("p",null,"A continuaci\xf3n, se realiza una consulta a la base de datos utilizando el Query Builder de Laravel. Se seleccionan los campos ",(0,o.kt)("inlineCode",{parentName:"p"},"nombre")," de subcategor\xeda, ",(0,o.kt)("inlineCode",{parentName:"p"},"nombre")," de poblaci\xf3n y todos los campos de la tabla ",(0,o.kt)("inlineCode",{parentName:"p"},"anuncios"),". Se establecen las relaciones entre las tablas ",(0,o.kt)("inlineCode",{parentName:"p"},"anuncios"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"subcategorias")," y ",(0,o.kt)("inlineCode",{parentName:"p"},"poblaciones")," mediante las cl\xe1usulas ",(0,o.kt)("inlineCode",{parentName:"p"},"join"),"."),(0,o.kt)("p",null,"Se aplican filtros a la consulta utilizando los valores proporcionados por el usuario. Se compara el nombre de la poblaci\xf3n con el valor ingresado, se busca coincidencias parciales en el t\xedtulo del anuncio y se filtra por el ID de la subcategor\xeda seleccionada."),(0,o.kt)("p",null,"El resultado de la consulta se guarda en la variable ",(0,o.kt)("inlineCode",{parentName:"p"},"$anuncios"),"."),(0,o.kt)("p",null,"A continuaci\xf3n, se obtienen todos los estados y todas las categor\xedas desde sus respectivas tablas y se almacenan en las variables ",(0,o.kt)("inlineCode",{parentName:"p"},"$estados")," y ",(0,o.kt)("inlineCode",{parentName:"p"},"$categorias"),"."),(0,o.kt)("p",null,"Finalmente, se devuelve la vista ",(0,o.kt)("inlineCode",{parentName:"p"},"anuncios.index")," pasando las variables ",(0,o.kt)("inlineCode",{parentName:"p"},"$anuncios"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"$categorias"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"$estados"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"$poblacion"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"$titulo")," y ",(0,o.kt)("inlineCode",{parentName:"p"},"$subcategoriaId")," utilizando la funci\xf3n ",(0,o.kt)("inlineCode",{parentName:"p"},"view()")," y el m\xe9todo ",(0,o.kt)("inlineCode",{parentName:"p"},"compact()"),"."),(0,o.kt)("p",null,"En definitiva, este c\xf3digo procesa una solicitud de filtrado de anuncios, realiza una consulta a la base de datos utilizando los criterios de b\xfasqueda proporcionados por el usuario y muestra los resultados en una vista espec\xedfica."),(0,o.kt)("admonition",{title:"An\xe1lisis de la consulta $anuncios",type:"info"},(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-php"}," $anuncios=DB::table('anuncios as A')\n    ->select('S.nombre', 'P.nombre', 'A.*')\n    ->join('subcategorias as S', 'A.subcategoria_id', '=', 'S.id')\n    ->join('poblaciones as P', 'P.codigo', '=', 'A.cod_postal')\n    ->where('P.nombre', 'like', $poblacion .'%')\n    ->where('A.titulo', 'like', '%'.$titulo.'%')\n    ->where('S.id', '=', $subcategoriaId)\n    ->get();\n")),(0,o.kt)("p",{parentName:"admonition"},"Esta consulta en Laravel utiliza la sintaxis del constructor de consultas para obtener una lista de anuncios filtrados seg\xfan ciertos criterios."),(0,o.kt)("p",{parentName:"admonition"},"Aqu\xed hay un an\xe1lisis conciso de la consulta:"),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"En la l\xednea ",(0,o.kt)("inlineCode",{parentName:"p"},"$anuncios=DB::table('anuncios as A')"),", se establece la tabla principal de la consulta como 'anuncios', y se le asigna el alias 'A'.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"En la l\xednea ",(0,o.kt)("inlineCode",{parentName:"p"},"->select('S.nombre', 'P.nombre', 'A.*')"),", se especifican las columnas que se seleccionar\xe1n en la consulta. En este caso, se selecciona el nombre de la subcategor\xeda, el nombre de la poblaci\xf3n y todas las columnas de la tabla 'anuncios'.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"A continuaci\xf3n, se realizan dos operaciones de uni\xf3n (join) en las l\xedneas ",(0,o.kt)("inlineCode",{parentName:"p"},"->join('subcategorias as S', 'A.subcategoria_id', '=', 'S.id')")," y ",(0,o.kt)("inlineCode",{parentName:"p"},"->join('poblaciones as P', 'P.codigo', '=', 'A.cod_postal')"),". Estas uniones se realizan utilizando las claves extranjeras y las correspondientes claves primarias de las tablas 'subcategorias' y 'poblaciones' respectivamente. Estas uniones permiten relacionar los anuncios con sus subcategor\xedas y poblaciones correspondientes.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Luego, se aplican tres condiciones de filtrado en las l\xedneas ",(0,o.kt)("inlineCode",{parentName:"p"},"->where('P.nombre', 'like', $poblacion .'%')"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"->where('A.titulo', 'like', '%'.$titulo.'%')")," y ",(0,o.kt)("inlineCode",{parentName:"p"},"->where('S.id', '=', $subcategoriaId)"),". Estas condiciones filtran los anuncios seg\xfan el nombre de la poblaci\xf3n (que debe coincidir parcialmente con la variable ",(0,o.kt)("inlineCode",{parentName:"p"},"$poblacion"),"), el t\xedtulo del anuncio (que debe contener la cadena de texto de la variable ",(0,o.kt)("inlineCode",{parentName:"p"},"$titulo"),") y el identificador de la subcategor\xeda (que debe ser igual a la variable ",(0,o.kt)("inlineCode",{parentName:"p"},"$subcategoriaId"),").")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Finalmente, se llama al m\xe9todo ",(0,o.kt)("inlineCode",{parentName:"p"},"->get()")," para ejecutar la consulta y obtener los resultados. Los resultados se asignan a la variable ",(0,o.kt)("inlineCode",{parentName:"p"},"$anuncios"),"."))),(0,o.kt)("p",{parentName:"admonition"},"Como conclusi\xf3n, esta consulta utiliza el constructor de consultas de Laravel para obtener una lista de anuncios que cumplan con ciertos criterios de filtrado, como el nombre de la poblaci\xf3n, el t\xedtulo del anuncio y la subcategor\xeda. Los resultados se almacenan en la variable ",(0,o.kt)("inlineCode",{parentName:"p"},"$anuncios")," para su posterior uso.")),(0,o.kt)("h2",{id:"anunciosindex"},"Anuncios.index"),(0,o.kt)("p",null,"A continuaci\xf3n vamos a analizar la vista ",(0,o.kt)("strong",{parentName:"p"},"Anuncios.index")," que es llamada por el controlador explicado anteriormente."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"indexfilter",src:n(3322).Z,width:"1366",height:"828"})),(0,o.kt)("p",null,"El formulario permite al usuario filtrar los anuncios seg\xfan diferentes criterios."),(0,o.kt)("p",null,"En la secci\xf3n ",(0,o.kt)("inlineCode",{parentName:"p"},"@extends('layout.layout')"),", se indica que esta vista extiende el dise\xf1o de la plantilla llamada 'layout'. Esto significa que hereda su estructura y estilos."),(0,o.kt)("p",null,"En la secci\xf3n ",(0,o.kt)("inlineCode",{parentName:"p"},"@section('title', 'P\xe1gina de inicio')"),", se define el t\xedtulo de la p\xe1gina como 'P\xe1gina de inicio'."),(0,o.kt)("p",null,"Dentro de la secci\xf3n ",(0,o.kt)("inlineCode",{parentName:"p"},"@section('content')"),", se encuentra el contenido principal de la p\xe1gina. Comienza con un contenedor y una fila que albergan dos secciones de la p\xe1gina: el filtro y la lista de anuncios."),(0,o.kt)("p",null,"La secci\xf3n de filtro est\xe1 contenida en una tarjeta (",(0,o.kt)("inlineCode",{parentName:"p"},'<div class="card2 col-lg-3 mx-auto">'),"). Incluye un formulario con varios campos de entrada, como t\xedtulo, poblaci\xf3n, rango de precios, categor\xeda y estado. Estos campos permiten al usuario especificar los criterios de b\xfasqueda para filtrar los anuncios."),(0,o.kt)("p",null,"La secci\xf3n de anuncios est\xe1 contenida en otra tarjeta (",(0,o.kt)("inlineCode",{parentName:"p"},'<div class="card3 col-lg-8 mx-auto">'),"). Contiene una lista de anuncios que se generan din\xe1micamente utilizando un bucle ",(0,o.kt)("inlineCode",{parentName:"p"},"@foreach"),". Cada anuncio se muestra en una tarjeta individual con su t\xedtulo, precio e imagen. Al hacer clic en un anuncio, el usuario ser\xe1 redirigido a una p\xe1gina detallada del anuncio."),(0,o.kt)("p",null,"El c\xf3digo utiliza variables Blade, como ",(0,o.kt)("inlineCode",{parentName:"p"},"$titulo"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"$poblacion"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"$subcategoriaId"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"$anuncios"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"$categorias")," y ",(0,o.kt)("inlineCode",{parentName:"p"},"$estados"),", para pasar y mostrar los datos necesarios en la vista."),(0,o.kt)("p",null,"Esta vista muestra un formulario de filtro para buscar anuncios y una lista de anuncios filtrados. Los usuarios pueden ingresar diferentes criterios de b\xfasqueda para encontrar los anuncios que les interesen."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},'@extends(\'layout.layout\')\n\n@section(\'title\', \'P\xe1gina de inicio\')\n\n@section(\'content\')\n    <div class="container-fluid col-lg-12 mt-8">\n        <div class="row">\n            <div class="card2 col-lg-3 mx-auto">\n                <h4 class="text-center  mx-auto resaltado mt-3"><b>Filtro</b></h4>\n                <div class="container mt-4">\n                \x3c!-- formulario de filtro--\x3e\n                    <form action="{{ route(\'home.filterMultiple\') }}" method="POST">\n                        @csrf\n                        <div class="col-md-12">\n                            <label for="desde" class="form-label">\n                                <p class="text-sm">T\xedtulo\n                                <p>\n                            </label>\n                            <div class="mb-3">\n\n                                <input type="text" placeholder="T\xedtulo" class="form-control" id="titulo"\n                                    name="titulo" value="{{ $titulo }}"">\n                            </div>\n                        </div>\n                        <div class="col-md-12">\n                            <div class="mb-3">\n                                <label for="desde" class="form-label">\n                                    <p class="text-sm">Poblaci\xf3n\n                                    <p>\n                                </label>\n                                <input type="text" placeholder="Poblaci\xf3n" class="form-control" id="poblacion"\n                                    value="{{ $poblacion }}" name="poblacion">\n                            </div>\n                        </div>\n                        <div class="row col-lg-12 mx-auto">\n                            <div class="col-md-6">\n                                <label for="desde" class="form-label">\n                                    <p class="text-sm">Desde..\n                                    <p>\n                                </label>\n                                <input type="number" class="form-control" id="desde" name="desde" min="0"\n                                    value=0 max="10000">\n                            </div>\n                            <div class="col-md-6">\n                                <label for="hasta" class="form-label">\n                                    <p class="text-sm">Hasta\n                                    <p>\n                                </label>\n                                <input type="number" class="form-control" id="hasta" name="hasta" min="0"\n                                    value="10000" max="10000">\n                            </div>\n                        </div>\n                        <div class="col-lg-12">\n                            <div class="mb-2">\n                                <label>\n                                    <p class="text-sm">Categor\xeda\n                                    <p>\n                                </label>\n                                <select name="subcategoria_id" class="form-control">\n                                    @foreach ($categorias as $categoria)\n                                        <optgroup label="{{ $categoria->nombre }}">\n                                            @foreach ($categoria->subcategorias as $subcategoria)\n                                                <option value="{{ $subcategoria->id }}"\n                                                    {{ $subcategoria->id == $subcategoriaId ? \'selected\' : \'\' }}>\n                                                    {{ $subcategoria->nombre }}\n                                                </option>\n                                            @endforeach\n                                        </optgroup>\n                                    @endforeach\n                                </select>\n                            </div>\n                        </div>\n                        <div class="col-lg-12">\n                            <div class="mb-2">\n                                <label>\n                                    <p class="text-sm">Estado\n                                    <p>\n                                </label>\n                                <select name="estado_id" class="form-control">\n                                    @foreach ($estados as $estado)\n                                        <option value="{{ $estado->id }}">{{ $estado->nombre }}</option>\n                                    @endforeach\n                                </select>\n                            </div>\n\n                        </div>\n                        <button type="submit" class="btn btn-danger col-lg-12 m-1">buscar</button>\n                    </form>\n                </div>\n            </div>\n            <div class="card3 col-lg-8 mx-auto ">\n                <h4 class="text-center resaltado mx-auto mt-3"><b>Anuncios</b></h4>\n                <div class="row ">\n                    @foreach ($anuncios as $anuncio)\n                        <div class="card3 col-lg-4 mx-auto my-1">\n                            <a href="/anuncios/{{ $anuncio->id }}">\n                                <div class="card-title m-1">\n                                    <p class="resaltado">{{ $anuncio->titulo }}</p>\n                                </div>\n                                <div class="card-body m-1">\n                                    precio : <b>{{ $anuncio->precio }}</b>\n                                    <img src="{{ $anuncio->imagen }}" class="d-block w-100" alt="{{ $anuncio->titulo }}">\n                                </div>\n                            </a>\n                        </div>\n                    @endforeach\n                </div>\n            </div>\n        </div>\n    </div>\n    </div>\n@endsection\n')),(0,o.kt)("h3",{id:"an\xe1lisis-del-formulario-de-filtro"},"An\xe1lisis del formulario de filtro"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Filtro",src:n(2120).Z,width:"1366",height:"768"})),(0,o.kt)("p",null,"Este formulario es utilizado para filtrar anuncios seg\xfan ciertos criterios. Vamos a analizar sus elementos:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"El formulario tiene un atributo ",(0,o.kt)("inlineCode",{parentName:"p"},"action"),' que especifica la ruta a la que se enviar\xe1n los datos cuando se env\xede el formulario. En este caso, la ruta se llama "home.filterMultiple".')),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"El campo ",(0,o.kt)("inlineCode",{parentName:"p"},"@csrf")," es una directiva de Blade que genera un token CSRF (Cross-Site Request Forgery) para proteger contra ataques CSRF.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"El formulario contiene varios campos de entrada donde el usuario puede ingresar informaci\xf3n para filtrar los anuncios:"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},'Hay un campo de texto llamado "T\xedtulo" donde el usuario puede ingresar el t\xedtulo del anuncio que desea buscar.')),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},'Hay un campo de texto llamado "Poblaci\xf3n" donde el usuario puede ingresar el nombre de la poblaci\xf3n que desea filtrar.')),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},'Hay dos campos num\xe9ricos llamados "Desde" y "Hasta" donde el usuario puede ingresar un rango de precios para filtrar los anuncios.')),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},'Hay un men\xfa desplegable llamado "Categor\xeda" donde el usuario puede seleccionar una categor\xeda espec\xedfica para filtrar los anuncios.')),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},'Hay otro men\xfa desplegable llamado "Estado" donde el usuario puede seleccionar un estado espec\xedfico para filtrar los anuncios.')))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},'Al final del formulario, hay un bot\xf3n de tipo "submit" con el texto "Buscar". Cuando el usuario hace clic en este bot\xf3n, los datos del formulario se enviar\xe1n a la ruta especificada en el atributo ',(0,o.kt)("inlineCode",{parentName:"p"},"action"),"."))),(0,o.kt)("p",null,"El formulario permite al usuario ingresar criterios de b\xfasqueda para filtrar los anuncios. Cuando se env\xeda el formulario, los criterios seleccionados se enviar\xe1n a la ruta correspondiente para realizar la b\xfasqueda y mostrar los resultados."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},'  \x3c!-- formulario de filtro--\x3e\n    <form action="{{ route(\'home.filterMultiple\') }}" method="POST">\n        @csrf\n        <div class="col-md-12">\n            <label for="desde" class="form-label">\n                <p class="text-sm">T\xedtulo\n                <p>\n            </label>\n            <div class="mb-3">\n\n                <input type="text" placeholder="T\xedtulo" class="form-control" id="titulo"\n                    name="titulo" value="{{ $titulo }}"">\n            </div>\n        </div>\n        <div class="col-md-12">\n            <div class="mb-3">\n                <label for="desde" class="form-label">\n                    <p class="text-sm">Poblaci\xf3n\n                    <p>\n                </label>\n                <input type="text" placeholder="Poblaci\xf3n" class="form-control" id="poblacion"\n                    value="{{ $poblacion }}" name="poblacion">\n            </div>\n        </div>\n        <div class="row col-lg-12 mx-auto">\n            <div class="col-md-6">\n                <label for="desde" class="form-label">\n                    <p class="text-sm">Desde..\n                    <p>\n                </label>\n                <input type="number" class="form-control" id="desde" name="desde" min="0"\n                    value=0 max="10000">\n            </div>\n            <div class="col-md-6">\n                <label for="hasta" class="form-label">\n                    <p class="text-sm">Hasta\n                    <p>\n                </label>\n                <input type="number" class="form-control" id="hasta" name="hasta" min="0"\n                    value="10000" max="10000">\n            </div>\n        </div>\n        <div class="col-lg-12">\n            <div class="mb-2">\n                <label>\n                    <p class="text-sm">Categor\xeda\n                    <p>\n                </label>\n                <select name="subcategoria_id" class="form-control">\n                    @foreach ($categorias as $categoria)\n                        <optgroup label="{{ $categoria->nombre }}">\n                            @foreach ($categoria->subcategorias as $subcategoria)\n                                <option value="{{ $subcategoria->id }}"\n                                    {{ $subcategoria->id == $subcategoriaId ? \'selected\' : \'\' }}>\n                                    {{ $subcategoria->nombre }}\n                                </option>\n                            @endforeach\n                        </optgroup>\n                    @endforeach\n                </select>\n            </div>\n        </div>\n        <div class="col-lg-12">\n            <div class="mb-2">\n                <label>\n                    <p class="text-sm">Estado\n                    <p>\n                </label>\n                <select name="estado_id" class="form-control">\n                    @foreach ($estados as $estado)\n                        <option value="{{ $estado->id }}">{{ $estado->nombre }}</option>\n                    @endforeach\n                </select>\n            </div>\n\n        </div>\n        <button type="submit" class="btn btn-danger col-lg-12 m-1">buscar</button>\n    </form>\n')),(0,o.kt)("h2",{id:"vista-indexfilter"},"Vista indexFilter"),(0,o.kt)("p",null,"Vamos primero a ver la ruta ",(0,o.kt)("strong",{parentName:"p"},"home.filterMultiple")," que es invocada cuando presionamos el bot\xf3n\nbuscar del formulario."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"Route::post('/anunciosFilterMultiple', [HomeController::class,'anunciosFilterMultiple'])->name('home.filterMultiple');\n")),(0,o.kt)("p",null,"A continuaci\xf3n vamos a estudiar el m\xe9todo invocado en el controlador."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"public function anunciosFilterMultiple(Request $request){\n        $poblacion=$request->input('poblacion');\n        $titulo=$request->input('titulo');\n        $subcategoriaId=$request->input('subcategoria_id');\n        $estadoId=$request->input('estado_id');\n        $desde=$request->input('desde');\n        $hasta=$request->input('hasta');\n\n        $anuncios = Anuncio::select('subcategorias.nombre as subcategoria_nombre', 'poblaciones.nombre as poblacion_nombre', 'estados.nombre as estado_nombre', 'anuncios.*')\n        ->join('subcategorias', 'anuncios.subcategoria_id', '=', 'subcategorias.id')\n        ->join('poblaciones', 'anuncios.cod_postal', '=', 'poblaciones.codigo')\n        ->join('estados', 'anuncios.estado_id', '=', 'estados.id')\n        ->where('poblaciones.nombre', 'like', $poblacion.'%')\n        ->where('anuncios.titulo', 'like', '%'.$titulo.'%')\n        ->where('estados.id', '=', $estadoId)\n        ->where('subcategorias.id', '=', $subcategoriaId)\n        ->whereBetween('precio', [$desde, $hasta])\n        ->get();\n    \n        $categorias=Categoria::all();\n        $estados=Estado::all();\n        return view('anuncios.indexFilter', compact('anuncios','categorias','estados','poblacion','titulo','subcategoriaId','desde','hasta'));\n      }\n")),(0,o.kt)("h3",{id:"tablas-relacionadas-en-la-consulta"},"Tablas relacionadas en la consulta"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Relacion de tablas utilizada en anunciosFilter",src:n(1073).Z,width:"772",height:"456"}),"\nEl m\xe9todo ",(0,o.kt)("inlineCode",{parentName:"p"},"anunciosFilterMultiple")," se utiliza para filtrar los anuncios seg\xfan m\xfaltiples criterios. Veamos su funcionamiento paso a paso:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"El m\xe9todo recibe un objeto ",(0,o.kt)("inlineCode",{parentName:"p"},"Request")," que proporciona acceso a los datos enviados en la solicitud HTTP.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"El m\xe9todo utiliza el objeto ",(0,o.kt)("inlineCode",{parentName:"p"},"Request")," para obtener los valores de los campos enviados desde el formulario. Estos valores se asignan a variables como ",(0,o.kt)("inlineCode",{parentName:"p"},"$poblacion"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"$titulo"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"$subcategoriaId"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"$estadoId"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"$desde")," y ",(0,o.kt)("inlineCode",{parentName:"p"},"$hasta"),". Estos valores representan los criterios de b\xfasqueda ingresados por el usuario en el formulario.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"A continuaci\xf3n, se realiza una consulta a la base de datos para obtener los anuncios que cumplen con los criterios de b\xfasqueda. La consulta se realiza utilizando el modelo ",(0,o.kt)("inlineCode",{parentName:"p"},"Anuncio")," y los m\xe9todos ",(0,o.kt)("inlineCode",{parentName:"p"},"select"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"join"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"where"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"whereBetween")," y ",(0,o.kt)("inlineCode",{parentName:"p"},"get"),"."),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"En la cl\xe1usula ",(0,o.kt)("inlineCode",{parentName:"p"},"select"),", se especifican los campos que se desean recuperar de la base de datos, incluyendo campos de tablas relacionadas como ",(0,o.kt)("inlineCode",{parentName:"p"},"subcategorias"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"poblaciones")," y ",(0,o.kt)("inlineCode",{parentName:"p"},"estados"),".")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Mediante los m\xe9todos ",(0,o.kt)("inlineCode",{parentName:"p"},"join"),", se establecen las relaciones entre las tablas ",(0,o.kt)("inlineCode",{parentName:"p"},"anuncios"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"subcategorias"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"poblaciones")," y ",(0,o.kt)("inlineCode",{parentName:"p"},"estados"),".")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Mediante los m\xe9todos ",(0,o.kt)("inlineCode",{parentName:"p"},"where"),", se aplican las condiciones de b\xfasqueda utilizando los valores de las variables ",(0,o.kt)("inlineCode",{parentName:"p"},"$poblacion"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"$titulo"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"$estadoId")," y ",(0,o.kt)("inlineCode",{parentName:"p"},"$subcategoriaId"),".")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"El m\xe9todo ",(0,o.kt)("inlineCode",{parentName:"p"},"whereBetween")," se utiliza para buscar anuncios que tengan un precio dentro del rango especificado por las variables ",(0,o.kt)("inlineCode",{parentName:"p"},"$desde")," y ",(0,o.kt)("inlineCode",{parentName:"p"},"$hasta"),".")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Finalmente, el m\xe9todo ",(0,o.kt)("inlineCode",{parentName:"p"},"get")," se utiliza para obtener los resultados de la consulta.")))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Se recuperan todas las categor\xedas y estados de la base de datos utilizando los modelos ",(0,o.kt)("inlineCode",{parentName:"p"},"Categoria")," y ",(0,o.kt)("inlineCode",{parentName:"p"},"Estado"),", respectivamente.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},'Se devuelve una vista llamada "anuncios.indexFilter" y se pasan los datos recuperados de la consulta y las variables de los criterios de b\xfasqueda a la vista utilizando el m\xe9todo ',(0,o.kt)("inlineCode",{parentName:"p"},"compact"),"."))),(0,o.kt)("p",null,"En definitiva, este m\xe9todo de controlador recibe los criterios de b\xfasqueda enviados desde un formulario, realiza una consulta a la base de datos para obtener los anuncios que cumplen con esos criterios y devuelve una vista con los resultados de la b\xfasqueda. Adem\xe1s, tambi\xe9n recupera las categor\xedas y estados para mostrarlos en la vista."),(0,o.kt)("h2",{id:"vista-anunciosshow"},"Vista anuncios.show"),(0,o.kt)("p",null,"Esta vista sera responsable de mostrar el detalle de un anuncio determinado."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Anuncios show",src:n(9567).Z,width:"1366",height:"1106"})),(0,o.kt)("p",null,"Para ello deberemos antes definir la ",(0,o.kt)("strong",{parentName:"p"},"ruta")," y el ",(0,o.kt)("strong",{parentName:"p"},"controlador"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:"title=Ruta",title:"Ruta"},"Route::get('anuncios/{id}', [AnuncioController::class,'show'])->name('anuncios.show');\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:"title=Controlador",title:"Controlador"},"public function show($id)\n    {\n        $anuncio = Anuncio::findOrFail($id);\n\n        return view('anuncios.show', compact('anuncio'));\n    }\n")),(0,o.kt)("p",null,"Pasemos a estudiar el c\xf3digo de la vista:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:"title=anuncios.show",title:"anuncios.show"},'@extends(\'layout.layout\')\n\n@section(\'title\', \'P\xe1gina de inicio\')\n\n@section(\'content\')\n       <section class="container mt-8 ">\n        <div class="card col-lg-10 mx-auto">\n            <div class="card-header m-1">\n                <h4 class="resaltado text-center"><b>{{ $anuncio->titulo }}</b></h4>\n                <h5 class="text-center">Precio : <b>{{ $anuncio->precio }}</h5>\n                    <h5 class="text-center"></b> Estado :\n                    <b>{{ $anuncio->estado->nombre }}</b>\n                    Categor\xeda : <b>{{ $anuncio->subcategoria->categoria->nombre }}</b>\n                    SubCategor\xeda : <b>{{ $anuncio->subcategoria->nombre }}</b>\n                </h5>\n            </div>\n            <div class="card-body m-1">\n                <img src="{{ $anuncio->imagen }}" class="d-block w-100" alt="{{ $anuncio->titulo }}">\n                <div class="container mt-4">\n                    <h5>{{ $anuncio->description }}</h5>\n                </div>\n            </div>\n        </div>\n    </section>\n@endsection\n')),(0,o.kt)("p",null,"Veamos qu\xe9 hace cada una de las directivas utilizadas en esta vista:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"@extends('layout.layout')"),": Esta l\xednea indica que esta vista extiende o hereda el contenido de otra plantilla llamada 'layout.layout'. Esto significa que el contenido de 'layout.layout' se incluir\xe1 en esta vista, y esta vista puede agregar o sobrescribir secciones espec\xedficas de la plantilla base.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"@section('title', 'P\xe1gina de inicio')"),": Esta directiva define una secci\xf3n llamada 'title' y establece su valor como 'P\xe1gina de inicio'. Las secciones son \xe1reas dentro de la plantilla base donde se puede insertar contenido espec\xedfico de cada vista. En este caso, se est\xe1 definiendo la secci\xf3n 'title' y se le est\xe1 asignando el valor 'P\xe1gina de inicio'.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"@section('content')"),": Esta directiva define una secci\xf3n llamada 'content'. Aqu\xed es donde se colocar\xe1 el contenido espec\xedfico de esta vista. El contenido que se coloque dentro de esta secci\xf3n se insertar\xe1 en el lugar correspondiente de la plantilla base.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"A partir de aqu\xed, se encuentra el contenido espec\xedfico de esta vista. En este caso, se trata de un c\xf3digo HTML y PHP que muestra los detalles de un anuncio. Dentro de este contenido, se utilizan variables para acceder a los datos del anuncio, como ",(0,o.kt)("inlineCode",{parentName:"p"},"$anuncio->titulo"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"$anuncio->precio"),", etc. Estas variables se supone que est\xe1n disponibles en la vista y contienen los datos del anuncio.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"@endsection"),": Esta directiva marca el final de la secci\xf3n 'content'. Indica que el contenido de esta secci\xf3n ha terminado y se debe insertar en la plantilla base."))),(0,o.kt)("p",null,"En resumen, esta vista extiende una plantilla llamada 'layout.layout', define una secci\xf3n 'title' con el valor 'P\xe1gina de inicio', y tiene un contenido espec\xedfico que muestra los detalles de un anuncio. Cuando se renderiza esta vista, el contenido de la secci\xf3n 'content' se inserta en la plantilla base en el lugar correspondiente."))}p.isMDXComponent=!0},9567:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/anuncio1-be5e447569c9c9108e488f2659f44995.png"},6326:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/busqueda-546d1ee8704dff6771a6766fd53d3683.png"},1073:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/filterMultipleR-0ca3c0d49e320ba244bad64071bb5fbe.png"},2120:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/filtro2-26911778818bb2732dc84169b7b704ef.png"},3322:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/indexfilter-3c9691b135dd6a851bc801738771fea2.png"}}]);